"use strict";var pullTabs=pullTabs||{};pullTabs.Config=pullTabs.Config||function(){return{credentials:{consumer_key:"***REMOVED***"},configuration:{mode:"PRODUCTION"},app:{name:"Pull Tabs"}}}();var chrome=chrome||{},pullTabs=pullTabs||{};pullTabs.Browser=pullTabs.Browser||{ENV:"",browser:function(){},init:function(){this.ENV=pullTabs.Config.configuration.mode,this.isFirefox=navigator.userAgent.toLowerCase().indexOf("firefox")>-1,this.setBrowser(),void 0===localStorage.pullTabsFolderId&&this.getBookmarks()},setBrowser:function(){"DEVELOPMENT"===this.ENV?this.browser=DevBrowse:this.browser=void 0!==chrome?PTChrome:DevBrowse},isFile:function(e){return e.split("/").pop().split(".").length>1},getTabs:function(){return this.browser.getTabs()},getBookmarks:function(e){this.browser.getBookmarks(e)},closeTabs:function(e){this.browser.closeTabs(e)},closeTab:function(){this.browser.closeTab(tab)},bookmarkTabs:function(e){this.browser.bookmarkTabs(e)},bookmarkTab:function(){this.browser.bookmarkTab(tab)},downloadUrls:function(e){this.browser.downloadUrls(e)},login:function(e){this.browser.login(e)},save:function(e,t){this.browser.save(e,t)},retrieve:function(e,t){return this.browser.retrieve(e,t)},createTab:function(e){this.browser.createTab(e)},store:function(e,t){this.browser.store(e,t)},getStorageType:function(){this.browser.getStorageType()}};var DevBrowse={downloadUrls:function(e){e.forEach(function(e){e.url})},getTabs:function(){return'[{"active":false,"height":779,"highlighted":false,"id":71,"incognito":false,"index":0,"pinned":false,"selected":false,"status":"complete","title":"Dot Boston: Apple, Bicycles, Boston, Dot and Web Media","url":"http://adamp.com/","width":1440,"windowId":68},{"active":false,"height":779,"highlighted":false,"id":83,"incognito":false,"index":1,"pinned":false,"selected":false,"status":"complete","title":"Is It Boston? Find out if your area is part of Boston.","url":"http://isitboston.com/","width":1440,"windowId":68},{"active":false,"height":779,"highlighted":false,"id":85,"incognito":false,"index":2,"pinned":false,"selected":false,"status":"complete","title":"amiacylon.com","url":"http://amiacylon.com/","width":1440,"windowId":68},{"active":true,"height":779,"highlighted":true,"id":91,"incognito":false,"index":3,"pinned":false,"selected":true,"status":"complete","title":"3571814663_5c742efc65_b.jpg (1024Ã—768)","url":"https://c4.staticflickr.com/4/3322/3571814663_5c742efc65_b.jpg","width":1440,"windowId":68}]'}},PTChrome={downloadUrls:function(e){e.forEach(function(e){if(void 0!==e.labelTabId&&null!==e.labelTabId){var t=document.getElementById("label-tab-"+e.labelTabId);document.getElementById("status")}var o={url:e.url};pullTabs.Browser.isFirefox||(o.method="GET"),pullTabs.Browser.isFirefox&&(pullTabs.Browser.isFile(e.url)||(o.filename=e.title.toString()+".html"));try{chrome.downloads.download(o,function(o){if(void 0===o)return t&&t.setAttribute("class",t.className+" failed"),void pullTabs.Form.updateStatus(e,"Failed downloading ");t&&t.setAttribute("class",t.className+" successful");var r=document.createElement("span"),a=document.createElement("a"),s=document.createTextNode("Downloaded ");a.title=e.title.toString(),a.href=e.url,a.textContent=e.title.toString(),r.appendChild(s),r.appendChild(a),pullTabs.App.updateStatusMessage(r,"short","success");e.active})}catch(t){pullTabs.Form.updateStatus(e,"Error downloading ")}})},getTabs:function(){return new Promise(function(e,t){var o={currentWindow:!0};chrome.tabs.query(o,function(o){if("object"==typeof o)return void e(o);t(Error("Couldnt get tabs"))})})},getBookmarks:function(e){var t;e=function(e){t=e[0].children[1];var o,r=t.children.length,a=function(e){};for(o=0;o<r&&"Pulltabs"!==t.children[o].title;o++)if(o==r-1){var s={parentId:t.id,title:"Pulltabs"};chrome.bookmarks.create(s,a)}localStorage.pullTabsFolderId=t.children[o].id},void 0===localStorage.pullTabsFolderId&&chrome.bookmarks.getTree(e)},closeTabs:function(e){var t,o=e.length;for(t=0;t<o;t++)this.closeTab(e[t])},closeTab:function(e){chrome.tabs.remove(e.id)},bookmarkTabs:function(e){var t,o=e.length;for(t=0;t<o;t++)this.bookmarkTab(e[t])},bookmarkTab:function(e,t){var o={parentId:localStorage.pullTabsFolderId,title:e.title.toString(),url:e.url};chrome.bookmarks.create(o,function(t){var o=document.createElement("a"),r=document.createElement("span"),a=document.createTextNode("Successfuly bookmarked ");o.title=e.title.toString(),o.href=e.url,o.textContent=e.title.toString(),r.appendChild(a),r.appendChild(o),pullTabs.App.updateStatusMessage(r,"short","success")})},login:function(e){var t=chrome.extension.getURL("pocket.html");e.auth=e.auth+encodeURIComponent(t),window.open(e.auth)},loginViaWebAuthFlow:function(e){e.auth=e.auth+encodeURIComponent(chrome.identity.getRedirectURL()),e.interactive=!0;var t={url:e.auth,interactive:e.interactive};chrome.identity.launchWebAuthFlow(t,function(t){Pocket.getAccessToken(e)})},getStorageType:function(){if(pullTabs.Browser.isFirefox){if(void 0!==chrome.storage.local&&void 0!==chrome.storage.local.get)return pullTabs.Browser.storageType=chrome.storage.local,pullTabs.Browser.storageType}else if(void 0!==chrome.storage.sync&&void 0!==chrome.storage.sync.get)return pullTabs.Browser.storageType=chrome.storage.sync,pullTabs.Browser.storageType},store:function(e,t){if(pullTabs.Browser.getStorageType(),void 0===pullTabs.Browser.storageType)return void t();try{pullTabs.Browser.storageType.set(e,t)}catch(e){return}},save:function(e,t){chrome.storage;try{chrome.storage.local.set(t,function(){var t=document.getElementById("status");t.textContent=e+" saved.",setTimeout(function(){t.textContent=""},750)})}catch(e){}},retrieve:function(e,t){var o;return pullTabs.Browser.isFirefox?void 0!==chrome.storage.local&&void 0!==chrome.storage.local.get&&(o=chrome.storage.local):void 0!==chrome.storage.sync&&void 0!==chrome.storage.sync.get&&(o=chrome.storage.sync),new Promise(function(t,r){o.get(e,function(e){if(void 0!==e)return t(e),e;r(Error("Couldn't retrieve key"))})})},createTab:function(e){if(void 0!==chrome.tabs.create)return void chrome.tabs.create(e)},extensionGetURL:function(e){return void 0!==chrome.extension.getURL&&chrome.extension.getURL(e)}};pullTabs.Browser.ENV,pullTabs.Browser.ENV,pullTabs.Browser.init(pullTabs);var aboutPullTabs=aboutPullTabs||{init:function(){var e,t=document.getElementById("about-credits"),o=t.getElementsByTagName("a"),r=o.length;for(e=0;e<r;e++)o[e].addEventListener("click",function(e){var t={url:e.target.href,active:!1};pullTabs.Browser.createTab(t)})}};aboutPullTabs.init();