var pullTabs=pullTabs||{},pullTabs=pullTabs||{};pullTabs.Config=pullTabs.Config||function(){return{credentials:{consumer_key:"***REMOVED***"},configuration:{mode:"PRODUCTION"},app:{name:"Pull Tabs"}}}();var chrome=chrome||{},pullTabs=pullTabs||{};pullTabs.Browser=pullTabs.Browser||{ENV:"",browser:function(){},init:function(){this.ENV=pullTabs.Config.configuration.mode,this.isFirefox=navigator.userAgent.toLowerCase().indexOf("firefox")>-1,this.setBrowser(),void 0===localStorage.pullTabsFolderId&&this.getBookmarks()},setBrowser:function(){"DEVELOPMENT"===this.ENV?this.browser=DevBrowse:this.browser=void 0!==chrome?PTChrome:DevBrowse},isFile:function(e){return e.split("/").pop().split(".").length>1},getTabs:function(){return this.browser.getTabs()},getBookmarks:function(e){this.browser.getBookmarks(e)},closeTabs:function(e){this.browser.closeTabs(e)},closeTab:function(){this.browser.closeTab(tab)},bookmarkTabs:function(e){this.browser.bookmarkTabs(e)},bookmarkTab:function(){this.browser.bookmarkTab(tab)},downloadUrls:function(e){this.browser.downloadUrls(e)},login:function(e){this.browser.login(e)},save:function(e,t){this.browser.save(e,t)},retrieve:function(e,t){return this.browser.retrieve(e,t)},createTab:function(e){this.browser.createTab(e)},store:function(e,t){this.browser.store(e,t)},getStorageType:function(){this.browser.getStorageType()}};var DevBrowse={downloadUrls:function(e){e.forEach(function(e){e.url})},getTabs:function(){return'[{"active":false,"height":779,"highlighted":false,"id":71,"incognito":false,"index":0,"pinned":false,"selected":false,"status":"complete","title":"Dot Boston: Apple, Bicycles, Boston, Dot and Web Media","url":"http://adamp.com/","width":1440,"windowId":68},{"active":false,"height":779,"highlighted":false,"id":83,"incognito":false,"index":1,"pinned":false,"selected":false,"status":"complete","title":"Is It Boston? Find out if your area is part of Boston.","url":"http://isitboston.com/","width":1440,"windowId":68},{"active":false,"height":779,"highlighted":false,"id":85,"incognito":false,"index":2,"pinned":false,"selected":false,"status":"complete","title":"amiacylon.com","url":"http://amiacylon.com/","width":1440,"windowId":68},{"active":true,"height":779,"highlighted":true,"id":91,"incognito":false,"index":3,"pinned":false,"selected":true,"status":"complete","title":"3571814663_5c742efc65_b.jpg (1024Ã—768)","url":"https://c4.staticflickr.com/4/3322/3571814663_5c742efc65_b.jpg","width":1440,"windowId":68}]'}},PTChrome={downloadUrls:function(e){e.forEach(function(e){if(void 0!==e.labelTabId&&null!==e.labelTabId){var t=document.getElementById("label-tab-"+e.labelTabId);document.getElementById("status")}var o={url:e.url};pullTabs.Browser.isFirefox||(o.method="GET"),pullTabs.Browser.isFirefox&&(pullTabs.Browser.isFile(e.url)||(o.filename=e.title.toString()+".html"));try{chrome.downloads.download(o,function(o){if(void 0===o)return t&&t.setAttribute("class",t.className+" failed"),void pullTabs.Form.updateStatus(e,"Failed downloading ");t&&t.setAttribute("class",t.className+" successful");var n=document.createElement("span"),s=document.createElement("a"),a=document.createTextNode("Downloaded ");s.title=e.title.toString(),s.href=e.url,s.textContent=e.title.toString(),n.appendChild(a),n.appendChild(s),pullTabs.App.updateStatusMessage(n,"short","success");e.active})}catch(t){pullTabs.Form.updateStatus(e,"Error downloading ")}})},getTabs:function(){return new Promise(function(e,t){var o={currentWindow:!0};chrome.tabs.query(o,function(o){if("object"==typeof o)return void e(o);t(Error("Couldnt get tabs"))})})},getBookmarks:function(e){var t;e=function(e){t=e[0].children[1];var o,n=t.children.length,s=function(e){};for(o=0;o<n&&"Pulltabs"!==t.children[o].title;o++)if(o==n-1){var a={parentId:t.id,title:"Pulltabs"};chrome.bookmarks.create(a,s)}localStorage.pullTabsFolderId=t.children[o].id},void 0===localStorage.pullTabsFolderId&&chrome.bookmarks.getTree(e)},closeTabs:function(e){var t,o=e.length;for(t=0;t<o;t++)this.closeTab(e[t])},closeTab:function(e){chrome.tabs.remove(e.id)},bookmarkTabs:function(e){var t,o=e.length;for(t=0;t<o;t++)this.bookmarkTab(e[t])},bookmarkTab:function(e,t){var o={parentId:localStorage.pullTabsFolderId,title:e.title.toString(),url:e.url};chrome.bookmarks.create(o,function(t){var o=document.createElement("a"),n=document.createElement("span"),s=document.createTextNode("Successfuly bookmarked ");o.title=e.title.toString(),o.href=e.url,o.textContent=e.title.toString(),n.appendChild(s),n.appendChild(o),pullTabs.App.updateStatusMessage(n,"short","success")})},login:function(e){var t=chrome.extension.getURL("pocket.html");e.auth=e.auth+encodeURIComponent(t),window.open(e.auth)},loginViaWebAuthFlow:function(e){e.auth=e.auth+encodeURIComponent(chrome.identity.getRedirectURL()),e.interactive=!0;var t={url:e.auth,interactive:e.interactive};chrome.identity.launchWebAuthFlow(t,function(t){Pocket.getAccessToken(e)})},getStorageType:function(){if(pullTabs.Browser.isFirefox){if(void 0!==chrome.storage.local&&void 0!==chrome.storage.local.get)return pullTabs.Browser.storageType=chrome.storage.local,pullTabs.Browser.storageType}else if(void 0!==chrome.storage.sync&&void 0!==chrome.storage.sync.get)return pullTabs.Browser.storageType=chrome.storage.sync,pullTabs.Browser.storageType},store:function(e,t){if(pullTabs.Browser.getStorageType(),void 0===pullTabs.Browser.storageType)return void t();try{pullTabs.Browser.storageType.set(e,t)}catch(e){return}},save:function(e,t){chrome.storage;try{chrome.storage.local.set(t,function(){var t=document.getElementById("status");t.textContent=e+" saved.",setTimeout(function(){t.textContent=""},750)})}catch(e){}},retrieve:function(e,t){var o;return pullTabs.Browser.isFirefox?void 0!==chrome.storage.local&&void 0!==chrome.storage.local.get&&(o=chrome.storage.local):void 0!==chrome.storage.sync&&void 0!==chrome.storage.sync.get&&(o=chrome.storage.sync),new Promise(function(t,n){o.get(e,function(e){if(void 0!==e)return t(e),e;n(Error("Couldn't retrieve key"))})})},createTab:function(e){if(void 0!==chrome.tabs.create)return void chrome.tabs.create(e)},extensionGetURL:function(e){return void 0!==chrome.extension.getURL&&chrome.extension.getURL(e)}};pullTabs.Browser.ENV,pullTabs.Browser.ENV,pullTabs.Browser.init(pullTabs);var pullTabs=pullTabs||{};pullTabs.Pocket=pullTabs.Pocket||{pocketKey:{access_token:"access_token",user_name:"user_name"},init:function(){if(void 0!==localStorage[this.pocketKey.user_name]&&"user_name"!==localStorage[this.pocketKey.user_name])return void this.isAuthorized();this.isNotAuthorized()},checkLocalLoginStatus:function(){if(void 0!==localStorage[this.pocketKey.user_name]&&"user_name"!==localStorage[this.pocketKey.user_name])return void this.isAuthorized();this.isNotAuthorized()},isAuthorized:function(){var e=document.getElementById("pocket-status");null!==e&&(e.href="#pocket-logout",e.textContent="You are signed in as "+decodeURIComponent(localStorage[this.pocketKey.user_name])+" Click to log out.")},isNotAuthorized:function(){var e=document.getElementById("pocket-status");e.href="#pocket-login",e.textContent="You are not authorized, please sign in."},logOut:function(){localStorage[this.pocketKey.user_name]="user_name",localStorage[this.pocketKey.access_token]="access_token",chrome.storage.local.set({access_token:"access_token",user_name:"user_name"},function(e){}),this.isNotAuthorized()},checkLink:function(e){var t=e.target.href.indexOf("#")+1;if("pocket-logout"===e.target.href.substring(t))return void pullTabs.Pocket.logOut();pullTabs.Pocket.initLogin()},initLogin:function(){var e={};e.url="https://getpocket.com/v3/oauth/request",e.key=pullTabs.Config.credentials.consumer_key,pullTabs.Pocket.getRequestToken(e)},saveTabToPocket:function(e){var t=e.url,o={url:t,consumer_key:pullTabs.Config.credentials.consumer_key,access_token:localStorage[this.pocketKey.access_token]};try{var n=new XMLHttpRequest;n.overrideMimeType("application/json"),n.open("POST","https://getpocket.com/v3/add",!1),n.setRequestHeader("Content-Type","application/json; charset=UTF-8"),n.setRequestHeader("X-Accept","application/json");var s,a=document.createElement("a"),r=document.createElement("span");a.title=e.title.toString(),a.href=e.url,a.textContent=e.title.toString(),n.onreadystatechange=function(){if(4===n.readyState&&200!==n.status)return void 0!==e.labelTabId&&e.labelTabId,s=document.createTextNode("Failed saving to Pocket "),r.appendChild(s),r.appendChild(a),pullTabs.App.updateStatusMessage(r,"dependent","danger"),!1;if(4===n.readyState&&200===n.status){void 0!==e.labelTabId&&e.labelTabId,s=document.createTextNode("Saved this tab to pocket: "),r.appendChild(s),r.appendChild(a),pullTabs.App.updateStatusMessage(r,"medium","success");return!0}},n.onerror=function(t){pullTabs.Form.setLabelStatus(e,"failed")},n.send(JSON.stringify(o))}catch(t){return pullTabs.Form.setLabelStatus(e,"failed"),!1}},saveTabsToPocket:function(e){var t,o=e.length;for(t=0;t<o;t++)this.saveTabToPocket(e[t])},getRequestToken:function(e){var t=chrome.extension.getURL("pocket.html"),o=new FormData;o.append("consumer_key",e.key),o.append("redirect_uri",encodeURIComponent(t));var n=new XMLHttpRequest;n.open("POST",e.url,!0),n.onload=function(t){4===n.readyState&&200===n.status&&(e.token=n.response.substring(5),localStorage[pullTabs.Pocket.pocketKey.request_token]=e.token,e.auth="https://getpocket.com/auth/authorize?request_token="+e.token+"&redirect_uri=",pullTabs.Browser.login(e))},n.onerror=function(e){},n.send(o)},getStoredCredentials:function(e){chrome.storage.local&&chrome.storage.local.get({access_token:"access_token",user_name:"user_name"},function(e){"user_name"!==e.user_name?pullTabs.Pocket.isAuthorized(e):pullTabs.Pocket.isNotAuthorized()})},setStoredCredentials:function(e){var t=e.search("=")+1,o=e.search("&"),n=o+10,s=e.substring(t,o),a=e.substring(n);localStorage[this.pocketKey.access_token]=s,localStorage[this.pocketKey.user_name]=a,this.isAuthorized()},getAccessToken:function(e){var e={};e.url="https://getpocket.com/v3/oauth/authorize",e.key=pullTabs.Config.credentials.consumer_key,e.token=localStorage[this.pocketKey.request_token];var t=new FormData;t.append("consumer_key",e.key),t.append("code",e.token);var o=new XMLHttpRequest;o.open("POST",e.url,!0),o.onload=function(e){4===o.readyState&&200===o.status&&pullTabs.Pocket.setStoredCredentials(o.response)},o.onerror=function(e){},o.send(t)}};var pullTabs=pullTabs||{};pullTabs.Options=pullTabs.Options||function(){function e(){s.mimeTypes.forEach(function(e){s.mimeSettings[e]=this.tabActions[0]},s)}function t(e){return e.charAt(0).toUpperCase()+e.slice(1)}function o(){for(var e=document.getElementById("file-type-destinations"),o=0;o<s.numOfmimeTypes;o++){var n=document.createElement("div");n.setAttribute("class","panel panel-default row");var a=document.createElement("div");a.setAttribute("class","panel-heading col-md-2");var r=document.createElement("h4");r.textContent=t(s.mimeTypes[o]),a.appendChild(r),n.appendChild(a);var i=document.createElement("div");i.setAttribute("class","panel-body col-md-10");for(var l=0;l<s.numOftabActions;l++){var c=document.createElement("label"),u=document.createElement("input");u.type="radio",u.id=s.tabActions[l],u.name=s.mimeTypes[o],u.value=s.tabActions[l];var d=document.createElement("span");d.textContent=t(s.tabActions[l]),c.appendChild(u),c.appendChild(d),i.appendChild(c)}n.appendChild(i),e.appendChild(n)}}function n(){document.getElementById("settings").addEventListener("submit",s.saveMimeSettings),document.getElementById("pocket-status").addEventListener("click",pullTabs.Pocket.checkLink),document.getElementById("full-mime-types").addEventListener("click",s.saveFullMimeType),document.getElementById("simple").addEventListener("click",s.saveLayout),document.getElementById("advanced").addEventListener("click",s.saveLayout),document.getElementById("autoclose").addEventListener("click",s.saveAutoClose)}var s={};return s.mimeTypes=["application","image","message","model","multipart","text","video","unknown"],s.numOfmimeTypes=s.mimeTypes.length,s.mimeSettings={},s.fullMimeType={retrieveFullMimeType:!1},s.layout={simple:!0,advanced:!1},s.autoClose={autoCloseTabs:!1},s.tabActions=["ignore","download","pocket","bookmark","close"],s.tabOptions=["enabled","disabled"],s.numOftabActions=s.tabActions.length,s.init=function(){n(),e(),o(),this.restoreMimeSettings().then(s.setSettings),this.getLayout().then(pullTabs.Options.setLayout),this.getAutoClose().then(pullTabs.Options.setAutoClose),this.getFullMimeType().then(function(e){pullTabs.Options.setFullMimeType(e)}).catch(function(e){}),pullTabs.Pocket.checkLocalLoginStatus()},s.getMimeTypes=function(){return s.mimeSettings},s.getMimeSettings=function(){return s.mimeSettings},s.restoreMimeSettings=function(e){return pullTabs.Browser.retrieve(s.mimeSettings,e)},s.setSettings=function(e){for(var t=0;t<s.numOfmimeTypes;t++)for(var o=document.getElementsByName(s.mimeTypes[t]),n=e[s.mimeTypes[t]],a=0;a<o.length;a++)o[a].id===n?(s.mimeSettings[s.mimeTypes[t]]=o[a].id,o[a].checked=!0):o[a].checked=!1},s.setLayout=function(e){var t=document.getElementById("simple"),o=document.getElementById("advanced");!0===e.simple?t.checked=!0:t.checked=!1,!0===e.advanced?o.checked=!0:o.checked=!1},s.setAutoClose=function(e){var t=document.getElementById("autoclose");!0===e.autoCloseTabs&&(t.checked=!0)},s.saveAutoClose=function(){!0===document.getElementById("autoclose").checked?s.autoClose.autoCloseTabs=!0:s.autoClose.autoCloseTabs=!1;try{pullTabs.Browser.store(s.autoClose,s.updateStatusMessage("Autoclose saved."))}catch(e){return!1}},s.saveLayout=function(){var e=document.getElementById("simple"),t=document.getElementById("advanced");!0===e.checked?s.layout.simple=!0:s.layout.simple=!1,!0===t.checked?s.layout.advanced=!0:s.layout.advanced=!1;try{pullTabs.Browser.store(s.layout,s.updateStatusMessage("Layout saved."))}catch(e){return!1}return!0},s.setFullMimeType=function(e){var t=document.getElementById("full-mime-types");!0===e.retrieveFullMimeType?t.checked=!0:t.checked=!1},s.saveFullMimeType=function(){var e=document.getElementById("full-mime-types").checked;s.fullMimeType.retrieveFullMimeType=!0===e;try{pullTabs.Browser.store(s.fullMimeType,s.updateStatusMessage("Full mime type saved."))}catch(e){return!1}},s.updateStatusMessage=function(e){var t=document.getElementById("status");t.classList.add("alert","alert-success"),t.classList.remove("hidden"),t.textContent=e,t.style.top=0,setTimeout(function(){t.textContent="",t.classList.remove("alert","alert-success"),t.classList.add("hidden")},1500)},s.getFullMimeType=function(){return pullTabs.Browser.retrieve(s.fullMimeType)},s.getLayout=function(){return pullTabs.Browser.retrieve(s.layout)},s.getAutoClose=function(){return pullTabs.Browser.retrieve(s.autoClose)},s.saveMimeSettings=function(e){e.preventDefault();for(var t=0;t<s.numOfmimeTypes;t++)for(var o=document.getElementsByName(s.mimeTypes[t]),n=0;n<s.numOftabActions;n++)o[n].checked&&(s.mimeSettings[s.mimeTypes[t]]=s.tabActions[n]);try{pullTabs.Browser.store(s.mimeSettings,s.updateStatusMessage("Mime settings saved"))}catch(e){return!1}return!0},s}(),pullTabs.Options.init();