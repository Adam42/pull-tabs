var pullTabs=pullTabs||{},pullTabs=pullTabs||{};pullTabs.Config=pullTabs.Config||function(){return{credentials:{consumer_key:"***REMOVED***"},configuration:{mode:"PRODUCTION"},app:{name:"Pull Tabs"}}}();var pullTabs=pullTabs||{};pullTabs.Form=pullTabs.Form||{options:"",init:function(e){this.options=e},createForm:function(e){pullTabs.App.getOptions(function(t){pullTabs.App.assembleForm(e,t)}),pullTabs.App.watchSubmit(e)},createCheckbox:function(e,t,a){var n=document.createElement("input");return n.type="checkbox",n.id="tab-"+e.index,n.name="tabs"+e.index,n.title=e.title+t,n.value=e.url,n.checked=a,n},createRadioInput:function(e,t,a){var n="";t===a&&(n="checked");var s=document.createElement("input");s.type="radio",s.id="tab-pref-"+e.index,s.name="tab-pref-"+e.index,s.value=t,s.checked=n;var o=document.createElement("label");return o.setAttribute("class","preferences"),o.innerHTML="<span>"+t+"</span>",o.appendChild(s),o},createLabel:function(e,t,a){var n=document.createElement("label");return n.setAttribute("class","list-group-item "+a),n.setAttribute("id","label-tab-"+e.index),n.innerHTML="<p>Title: "+e.title+"</p>","image"===t.split("/").shift()&&(n.innerHTML+='<img class="img-thumbnail" style="width: 150px; height: 150px;" src='+e.url+"/>"),n},toggleLabels:function(e){e.addEventListener("click",function(){var t=e.getElementsByTagName("input")[0];e.classList.contains("active")&&(t.checked||e.classList.remove("active")),e.classList.contains("active")||t.checked&&e.classList.add("active")})},setLabelStatus:function(e,t){var a=document.getElementById("label-tab-"+e.labelTabId);a.setAttribute("class",a.className+" "+t)},updateStatus:function(e,t){var a=document.getElementById("status"),n=document.createElement("a"),s=document.createElement("p"),o=document.createTextNode(t);n.title=e.title,n.href=e.url,n.innerHTML=e.title,s.appendChild(o),s.appendChild(n),a.appendChild(s),a.removeAttribute("class","hidden")},assembleForm:function(e,t){var a=document.getElementById("resources");e.forEach(function(e){pullTabs.App.getContentType(e.url,function(e){this.mType=e});var n=this.mType.split("/").shift().toLowerCase(),s=t[n]?t[n]:"ignore",o="",l="";"download"!==s&&"pocket"!==s||(o="checked",l="active");var i=pullTabs.App.createCheckbox(e,n,o),r=pullTabs.App.createRadioInput(e,"download",s),c=pullTabs.App.createRadioInput(e,"pocket",s),u=pullTabs.App.createRadioInput(e,"ignore",s),d=pullTabs.App.createLabel(e,n,l);d.appendChild(i),d.appendChild(r),d.appendChild(c),d.appendChild(u),a.appendChild(d)})},getSelectedGroup:function(){document.getElementById()},getSelectedTabs:function(e){var t,a=e.length,n=[],s=[],o=[],l=[],i=[];for(t=0;t<a;t++){if(document.getElementById("tab-"+t).checked){var r,c=document.getElementsByName("tab-pref-"+t);for(e[t].labelTabId=t,r=0;r<c.length;r++)if(c[r].checked){var u=c[r].value;switch(u){case"download":n.push(e[t]);break;case"pocket":s.push(e[t]);break;case"bookmark":o.push(e[t]);break;case"close":l.push(e[t]);break;default:i.push(e[t])}}}else i.push(e[t])}return e.downloads=n,e.pockets=s,e.closes=l,e.bookmarks=o,e.ignores=i,e},watchMutateCheck:function(){var e=document.querySelector("#resources"),t=new MutationObserver(function(e){e.forEach(function(e){var t=document.querySelector("#"+e.addedNodes[0].id+" > input"),a=document.querySelector("#label-"+t.id);a.addEventListener("click",function(){a.classList.contains("active")&&(t.checked||a.classList.remove("active")),a.classList.contains("active")||t.checked&&a.classList.add("active")})})}),a={attributes:!0,childList:!0,characterData:!0};t.observe(e,a)}};var pullTabs=pullTabs||{};pullTabs.Options=pullTabs.Options||function(){function e(){o.mimeTypes.forEach(function(e){o.mimeSettings[e]=this.tabActions[0]},o)}function t(e){return e.charAt(0).toUpperCase()+e.slice(1)}function a(){for(var e=document.getElementById("file-type-destinations"),a=0;a<o.numOfmimeTypes;a++){var n=document.createElement("div");n.setAttribute("class","panel panel-default row");var s=document.createElement("div");s.setAttribute("class","panel-heading col-md-2");var l=document.createElement("h4");l.textContent=t(o.mimeTypes[a]),s.appendChild(l),n.appendChild(s);var i=document.createElement("div");i.setAttribute("class","panel-body col-md-10");for(var r=0;r<o.numOftabActions;r++){var c=document.createElement("label"),u=document.createElement("input");u.type="radio",u.id=o.tabActions[r],u.name=o.mimeTypes[a],u.value=o.tabActions[r];var d=document.createElement("span");d.textContent=t(o.tabActions[r]),c.appendChild(u),c.appendChild(d),i.appendChild(c)}n.appendChild(i),e.appendChild(n)}}function n(){document.getElementById("settings").addEventListener("submit",o.saveMimeSettings),document.getElementById("pocket-status").addEventListener("click",pullTabs.Pocket.checkLink),document.getElementById("full-mime-types").addEventListener("click",o.saveFullMimeType),document.getElementById("simple").addEventListener("click",o.saveLayout),document.getElementById("advanced").addEventListener("click",o.saveLayout),document.getElementById("autoclose").addEventListener("click",o.saveAutoClose)}function s(){if(void 0!==localStorage[pullTabs.access_token]&&"access_token"!==localStorage[pullTabs.access_token]){document.getElementById("pocket-status");loginStatus=pullTabs.Pocket.checkLocalLoginStatus()}}var o={};return o.mimeTypes=["application","image","message","model","multipart","text","video","unknown"],o.numOfmimeTypes=o.mimeTypes.length,o.mimeSettings={},o.fullMimeType={retrieveFullMimeType:!1},o.layout={simple:!0,advanced:!1},o.autoClose={autoCloseTabs:!1},o.tabActions=["ignore","download","pocket","bookmark","close"],o.tabOptions=["enabled","disabled"],o.numOftabActions=o.tabActions.length,o.init=function(){n(),e(),a(),this.restoreMimeSettings().then(o.setSettings),this.getLayout().then(pullTabs.Options.setLayout),this.getAutoClose().then(pullTabs.Options.setAutoClose),this.getFullMimeType().then(function(e){pullTabs.Options.setFullMimeType(e)}).catch(function(e){}),s()},o.getMimeTypes=function(){return o.mimeSettings},o.getMimeSettings=function(){return o.mimeSettings},o.restoreMimeSettings=function(e){return pullTabs.Browser.retrieve(o.mimeSettings,e)},o.setSettings=function(e){for(var t=0;t<o.numOfmimeTypes;t++)for(var a=document.getElementsByName(o.mimeTypes[t]),n=e[o.mimeTypes[t]],s=0;s<a.length;s++)a[s].id===n?(o.mimeSettings[o.mimeTypes[t]]=a[s].id,a[s].checked=!0):a[s].checked=!1},o.setLayout=function(e){var t=document.getElementById("simple"),a=document.getElementById("advanced");!0===e.simple?t.checked=!0:t.checked=!1,!0===e.advanced?a.checked=!0:a.checked=!1},o.setAutoClose=function(e){var t=document.getElementById("autoclose");!0===e.autoCloseTabs&&(t.checked=!0)},o.saveAutoClose=function(){!0===document.getElementById("autoclose").checked?o.autoClose.autoCloseTabs=!0:o.autoClose.autoCloseTabs=!1;try{pullTabs.Browser.store(o.autoClose,o.updateStatusMessage("Autoclose saved."))}catch(e){return!1}},o.saveLayout=function(){var e=document.getElementById("simple"),t=document.getElementById("advanced");!0===e.checked?o.layout.simple=!0:o.layout.simple=!1,!0===t.checked?o.layout.advanced=!0:o.layout.advanced=!1;try{pullTabs.Browser.store(o.layout,o.updateStatusMessage("Layout saved."))}catch(e){return!1}return!0},o.setFullMimeType=function(e){var t=document.getElementById("full-mime-types");!0===e.retrieveFullMimeType?t.checked=!0:t.checked=!1},o.saveFullMimeType=function(){var e=document.getElementById("full-mime-types").checked;o.fullMimeType.retrieveFullMimeType=!0===e;try{pullTabs.Browser.store(o.fullMimeType,o.updateStatusMessage("Full mime type saved."))}catch(e){return!1}},o.updateStatusMessage=function(e){var t=document.getElementById("status");t.classList.add("alert","alert-success"),t.classList.remove("hidden"),t.textContent=e,t.style.top=0,setTimeout(function(){t.textContent="",t.classList.remove("alert","alert-success"),t.classList.add("hidden")},1500)},o.getFullMimeType=function(){return pullTabs.Browser.retrieve(o.fullMimeType)},o.getLayout=function(){return pullTabs.Browser.retrieve(o.layout)},o.getAutoClose=function(){return pullTabs.Browser.retrieve(o.autoClose)},o.saveMimeSettings=function(e){e.preventDefault();for(var t=0;t<o.numOfmimeTypes;t++)for(var a=document.getElementsByName(o.mimeTypes[t]),n=0;n<o.numOftabActions;n++)a[n].checked&&(o.mimeSettings[o.mimeTypes[t]]=o.tabActions[n]);try{pullTabs.Browser.store(o.mimeSettings,o.updateStatusMessage("Mime settings saved"))}catch(e){return!1}return!0},o}();var pullTabs=pullTabs||{};pullTabs.App=pullTabs.App||{tabs:"",prefs:"",layout:"",mimeTypesMap:{},linksWatched:!1,init:function(){if("no"!==localStorage.initialSetup)return localStorage.initialSetup="yes",void pullTabs.App.doInitialSetup();if(!pullTabs.App.tabs){var e=pullTabs.App.updateStatusMessage("Gathering your tabs","dependent","info");return void pullTabs.Browser.getTabs().then(function(t){return pullTabs.App.tabs=t,pullTabs.App.removeStatusMessage(e),t}).then(function(e){pullTabs.App.setNumTabs(e)}).then(pullTabs.App.getLayout().then(function(e){pullTabs.App.setLayout(e),pullTabs.App.displayLayout()})).catch(function(e){})}},updateStatusMessage:function(e,t,a){var n=document.getElementById("status"),s=document.createElement("p"),o="alert-"+a;if(s.classList.add("alert",o),n.classList.remove("hidden"),n.style.top=0,s.textContent=e,"object"==typeof e&&e instanceof HTMLElement&&(s.textContent="",s.appendChild(e)),s.id="status-message-"+n.children.length,n.children.length>0){var l=n.lastChild.id;l=l.replace("status-message-",""),l=parseInt(l)+1,s.id="status-message-"+l}switch(n.appendChild(s),t){case"short":setTimeout(pullTabs.App.removeStatusMessage,2e3,s.id);break;case"medium":setTimeout(pullTabs.App.removeStatusMessage,4e3,s.id);break;case"long":setTimeout(pullTabs.App.removeStatusMessage,8e3,s.id);break;case"dependent":return s.id;case"restack":break;default:setTimeout(pullTabs.App.removeStatusMessage,3e3,s.id)}},removeStatusMessage:function(e){null===typeof e&&(e="status-message-0");var t=document.getElementById(e),a=t.parentNode;t.remove(),a.children.length<=0&&a.classList.add("hidden")},doInitialSetup:function(){if(null===document.getElementById("setup")){var e=document.createElement("a");e.href=chrome.extension.getURL("options.html"),e.id="initial-load",e.textContent=" Setup PullTabs with your preferences.";var t=document.createElement("p");t.classList.add("alert","alert-info"),t.textContent="This appears to be your first time using PullTabs. Please visit the options page to define your preferences and setup any external services you wish to use.",t.id="setup",t.appendChild(e);var a=document.getElementById("simple").parentNode,n=document.getElementById("simple");a.insertBefore(t,n),t.addEventListener("click",function(e){e.preventDefault(),localStorage.initialSetup="no",chrome.runtime.openOptionsPage()})}},displayLayout:function(){if(pullTabs.App.layout.simple)pullTabs.App.watchButtons(),pullTabs.App.linksWatched||pullTabs.App.watchLinks();else{document.getElementById("simple").classList.add("hidden")}pullTabs.App.layout.advanced&&pullTabs.App.displayAdvancedLayout()},addMimeTypeToTabs:function(){return pullTabs.App.tabs.map(function(e){pullTabs.App.getContentType(e.url).then(function(t){var a="tab"+e.id.toString();pullTabs.App.setMimeTypesMap(a,t)}).catch(function(e){})})},setMimeTypesMap:function(e,t){pullTabs.App.mimeTypesMap[e]=t},displayAdvancedLayout:function(){document.getElementById("advanced").classList.remove("hidden"),this.getOptions().then(function(e){pullTabs.App.setOptions(e)}).then(pullTabs.App.getFullMimeType().then(function(e){e.retrieveFullMimeType?Promise.all(pullTabs.App.addMimeTypeToTabs).then(function(){pullTabs.App.assembleForm(pullTabs.App.tabs,pullTabs.App.pref,pullTabs.App.mimeTypesMap)}):pullTabs.App.assembleForm(pullTabs.App.tabs,pullTabs.App.pref,pullTabs.App.mimeTypesMap)}).then(function(){pullTabs.App.watchSubmit(pullTabs.App.tabs);var e=document.getElementById("resources").getElementsByClassName("list-group-item");pullTabs.App.watchCheckBoxes(e),pullTabs.App.watchMutateCheck(),pullTabs.App.setActions(),pullTabs.App.watchLinks()}))},watchCheckBoxes:function(e){var t;for(t=0;t<e.length;t++)pullTabs.Form.toggleLabels(e[t])},getUrls:function(e){var t=[];return e.forEach(function(e){t.push(e.url)}),t},setTabs:function(e){this.tabs=e},setNumTabs:function(e){document.getElementById("numTabs").innerHTML="This window has "+e.length+" tabs. Do this action to all tabs:"},getFullMimeType:function(){return pullTabs.Browser.retrieve(pullTabs.Options.fullMimeType)},assembleForm:function(e,t,a){e.forEach(function(e){a.length,pullTabs.App.displayDefaultAdvancedLayout(e)})},displayDefaultAdvancedLayout:function(e){var t=document.getElementById("resources"),a="ignore",n="",s="",o=pullTabs.Form,l=o.createCheckbox(e,"unknown",n),i=o.createRadioInput(e,"download",a),r=o.createRadioInput(e,"pocket",a),c=o.createRadioInput(e,"bookmark",a),u=o.createRadioInput(e,"close",a),d=o.createLabel(e,"unknown",s);d.appendChild(l),d.appendChild(i),d.appendChild(r),d.appendChild(c),d.appendChild(u),t.appendChild(d)},getTabStatus:function(){this.tabs=pullTabs.Form.getSelectedTabs(this.tabs),this.tabs.downloads.length>0&&pullTabs.Browser.downloadUrls(this.tabs.downloads),this.tabs.pockets.length>0&&pullTabs.Pocket.saveTabsToPocket(this.tabs.pockets),this.tabs.closes.length>0&&pullTabs.Browser.closeTabs(this.tabs.closes),this.tabs.bookmarks.length>0&&pullTabs.Browser.bookmarkTabs(this.tabs.bookmarks)},getContentType:function(e){return new Promise(function(t,a){var n=new XMLHttpRequest;n.onload=function(){if(200===n.status){var e=n.getResponseHeader("Content-Type");t(null!==e?e.split(";").shift().split("/").shift().toLowerCase():"unknown")}a(Error(n.statusText))},n.onerror=function(){a(Error(n.statusText))},n.open("HEAD",e),n.send()})},setLayout:function(e){pullTabs.App.layout=e},getLayout:function(){var e={simple:"true",advanced:"false"},t=pullTabs.App.updateStatusMessage("Loading layout","dependent","info");return pullTabs.Browser.retrieve(e).then(function(e){return pullTabs.App.removeStatusMessage(t),e})},doError:function(e){},getOptions:function(e){var t={application:"download",image:"download",message:"ignore",model:"ignore",multipart:"ignore",text:"download",video:"download",unknown:"ignore"};return pullTabs.Browser.retrieve(t,e)},setOptions:function(e){pullTabs.App.prefs=e},setActions:function(){var e={check:function(){pullTabs.App.setAllActive()},uncheck:function(){pullTabs.App.setAllInactive()}};$("body").on("click","[data-action]",function(){var t=$(this).data("action");t in e&&e[t].apply(this,arguments)})},setAllActive:function(){var e,t=document.querySelectorAll("#resources > label"),a=t.length;for(e=0;e<a;e++)t[e].classList.contains("active")||t[e].classList.add("active")},setAllInactive:function(){var e,t=document.querySelectorAll("#resources > label"),a=t.length;for(e=0;e<a;e++)t[e].classList.contains("active")&&t[e].classList.remove("active")},updateBackground:function(e,t){t.classList.contains("active")&&(e.checked||t.classList.remove("active")),t.classList.contains("active")||e.checked&&t.classList.add("active")},watchMutateCheck:function(){var e=document.querySelector("#resources"),t=new MutationObserver(function(e){e.forEach(function(e){var t=document.querySelector("#"+e.addedNodes[0].id+" > input"),a=document.querySelector("#label-"+t.id);a.addEventListener("click",function(){a.classList.contains("active")&&(t.checked||a.classList.remove("active")),a.classList.contains("active")||t.checked&&a.classList.add("active")})})}),a={attributes:!0,childList:!0,characterData:!0};t.observe(e,a)},process:function(e){e.preventDefault(),pullTabs.App.getTabStatus()},processGroup:function(e){e.preventDefault();document.getElementById("default")},doAction:function(e){e.preventDefault(),pullTabs.App.processButton(this.id)},processButton:function(e){switch(e){case"download":pullTabs.Browser.downloadUrls(pullTabs.App.tabs);break;case"pocket":pullTabs.Pocket.saveTabsToPocket(pullTabs.App.tabs);break;case"bookmark":pullTabs.Browser.bookmarkTabs(pullTabs.App.tabs);break;case"close":pullTabs.Browser.closeTabs(pullTabs.App.tabs)}},watchButtons:function(){document.getElementById("download").addEventListener("click",this.doAction),document.getElementById("pocket").addEventListener("click",this.doAction),document.getElementById("bookmark").addEventListener("click",this.doAction),document.getElementById("close").addEventListener("click",this.doAction),document.getElementById("ignore").addEventListener("click",this.doAction)},watchSubmit:function(){document.getElementById("default").addEventListener("submit",this.processGroup),document.getElementById("list").addEventListener("submit",this.process)},showMainContent:function(){var e=document.getElementById("main"),t=document.getElementById("about-credits");e.classList.remove("bounce"),t.classList.contains("hidden")||t.classList.add("hidden")},swapMainContent:function(){var e=document.getElementById("main"),t=document.getElementById("about-credits");return e.classList.contains("bounce")?(e.classList.remove("bounce"),void(t.classList.contains("hidden")||t.classList.add("hidden"))):e.classList.contains("bounce")?void 0:(e.classList.add("bounce"),void(t.classList.contains("hidden")&&t.classList.remove("hidden")))},swapContent:function(e,t){if(!t)return void pullTabs.App.getContent(e,pullTabs.App.swapContent);if(t){return void(document.getElementById("content").innerHTML=t)}},getContent:function(e,t){try{var a=new XMLHttpRequest;a.open("GET",e.href,!1),a.onload=function(n){if(4===a.readyState){if(200!==a.status)return;t(e,a.response)}},a.onerror=function(e){},a.send()}catch(e){}},watchLinks:function(){document.getElementById("about").addEventListener("click",function(){pullTabs.App.swapMainContent()}),document.getElementById("home").addEventListener("click",function(){pullTabs.App.showMainContent()});var e,t=document.getElementById("about-credits").getElementsByTagName("a"),a=t.length;for(e=0;e<a;e++)t[e].addEventListener("click",function(e){var t={url:e.target.href,active:!1};pullTabs.Browser.createTab(t)});pullTabs.App.linksWatched=!0}},document.addEventListener("DOMContentLoaded",function(){pullTabs.App.init()}),chrome.storage.onChanged.addListener(function(e,t){for(var a in e)if(e.hasOwnProperty("key")){e[a]}});var chrome=chrome||{},pullTabs=pullTabs||{};pullTabs.Browser=pullTabs.Browser||{ENV:"",browser:function(){},init:function(){this.ENV=pullTabs.Config.configuration.mode,this.isFirefox=navigator.userAgent.toLowerCase().indexOf("firefox")>-1,this.setBrowser(),void 0===localStorage.pullTabsFolderId&&this.getBookmarks()},setBrowser:function(){"DEVELOPMENT"===this.ENV?this.browser=DevBrowse:this.browser=void 0!==chrome?PTChrome:DevBrowse},isFile:function(e){return e.split("/").pop().split(".").length>1},getTabs:function(){return this.browser.getTabs()},getBookmarks:function(e){this.browser.getBookmarks(e)},closeTabs:function(e){this.browser.closeTabs(e)},closeTab:function(){this.browser.closeTab(tab)},bookmarkTabs:function(e){this.browser.bookmarkTabs(e)},bookmarkTab:function(){this.browser.bookmarkTab(tab)},downloadUrls:function(e){this.browser.downloadUrls(e)},login:function(e){this.browser.login(e)},save:function(e,t){this.browser.save(e,t)},retrieve:function(e,t){return this.browser.retrieve(e,t)},createTab:function(e){this.browser.createTab(e)},store:function(e,t){this.browser.store(e,t)},getStorageType:function(){this.browser.getStorageType()}};var DevBrowse={downloadUrls:function(e){e.forEach(function(e){e.url})},getTabs:function(){return'[{"active":false,"height":779,"highlighted":false,"id":71,"incognito":false,"index":0,"pinned":false,"selected":false,"status":"complete","title":"Dot Boston: Apple, Bicycles, Boston, Dot and Web Media","url":"http://adamp.com/","width":1440,"windowId":68},{"active":false,"height":779,"highlighted":false,"id":83,"incognito":false,"index":1,"pinned":false,"selected":false,"status":"complete","title":"Is It Boston? Find out if your area is part of Boston.","url":"http://isitboston.com/","width":1440,"windowId":68},{"active":false,"height":779,"highlighted":false,"id":85,"incognito":false,"index":2,"pinned":false,"selected":false,"status":"complete","title":"amiacylon.com","url":"http://amiacylon.com/","width":1440,"windowId":68},{"active":true,"height":779,"highlighted":true,"id":91,"incognito":false,"index":3,"pinned":false,"selected":true,"status":"complete","title":"3571814663_5c742efc65_b.jpg (1024×768)","url":"https://c4.staticflickr.com/4/3322/3571814663_5c742efc65_b.jpg","width":1440,"windowId":68}]'}},PTChrome={downloadUrls:function(e){e.forEach(function(e){if(void 0!==e.labelTabId&&null!==e.labelTabId){var t=document.getElementById("label-tab-"+e.labelTabId);document.getElementById("status")}var a={url:e.url};pullTabs.Browser.isFirefox||(a.method="GET"),pullTabs.Browser.isFirefox&&(pullTabs.Browser.isFile(e.url)||(a.filename=e.title+".html"));try{chrome.downloads.download(a,function(a){if(void 0===a)return t&&t.setAttribute("class",t.className+" failed"),void pullTabs.Form.updateStatus(e,"Failed downloading ");t&&t.setAttribute("class",t.className+" successful");var n=document.createElement("span"),s=document.createElement("a"),o=document.createTextNode("Downloaded ");s.title=e.title,s.href=e.url,s.innerHTML=e.title,n.appendChild(o),n.appendChild(s),pullTabs.App.updateStatusMessage(n,"short","success");e.active})}catch(t){pullTabs.Form.updateStatus(e,"Error downloading ")}})},getTabs:function(){return new Promise(function(e,t){var a={currentWindow:!0};chrome.tabs.query(a,function(a){if("object"==typeof a)return void e(a);t(Error("Couldnt get tabs"))})})},getBookmarks:function(e){var t;e=function(e){t=e[0].children[1];var a,n=t.children.length,s=function(e){};for(a=0;a<n&&"Pulltabs"!==t.children[a].title;a++)if(a==n-1){var o={parentId:t.id,title:"Pulltabs"};chrome.bookmarks.create(o,s)}localStorage.pullTabsFolderId=t.children[a].id},void 0===localStorage.pullTabsFolderId&&chrome.bookmarks.getTree(e)},closeTabs:function(e){var t,a=e.length;for(t=0;t<a;t++)this.closeTab(e[t])},closeTab:function(e){chrome.tabs.remove(e.id)},bookmarkTabs:function(e){var t,a=e.length;for(t=0;t<a;t++)this.bookmarkTab(e[t])},bookmarkTab:function(e,t){var a={parentId:localStorage.pullTabsFolderId,title:e.title,url:e.url};chrome.bookmarks.create(a,function(t){var a=document.createElement("a"),n=document.createElement("span"),s=document.createTextNode("Successfuly bookmarked ");a.title=e.title,a.href=e.url,a.innerHTML=e.title,n.appendChild(s),n.appendChild(a),pullTabs.App.updateStatusMessage(n,"short","success")})},login:function(e){var t=chrome.extension.getURL("pocket.html");e.auth=e.auth+encodeURIComponent(t),window.open(e.auth)},loginViaWebAuthFlow:function(e){e.auth=e.auth+encodeURIComponent(chrome.identity.getRedirectURL()),e.interactive=!0;var t={url:e.auth,interactive:e.interactive};chrome.identity.launchWebAuthFlow(t,function(t){Pocket.getAccessToken(e)})},getStorageType:function(){if(pullTabs.Browser.isFirefox){if(void 0!==chrome.storage.local&&void 0!==chrome.storage.local.get)return pullTabs.Browser.storageType=chrome.storage.local,pullTabs.Browser.storageType}else if(void 0!==chrome.storage.sync&&void 0!==chrome.storage.sync.get)return pullTabs.Browser.storageType=chrome.storage.sync,pullTabs.Browser.storageType},store:function(e,t){if(pullTabs.Browser.getStorageType(),void 0===pullTabs.Browser.storageType)return void t();try{pullTabs.Browser.storageType.set(e,t)}catch(e){return}},save:function(e,t){chrome.storage;try{chrome.storage.local.set(t,function(){var t=document.getElementById("status");t.textContent=e+" saved.",setTimeout(function(){t.textContent=""},750)})}catch(e){}},retrieve:function(e,t){var a;return pullTabs.Browser.isFirefox?void 0!==chrome.storage.local&&void 0!==chrome.storage.local.get&&(a=chrome.storage.local):void 0!==chrome.storage.sync&&void 0!==chrome.storage.sync.get&&(a=chrome.storage.sync),new Promise(function(t,n){a.get(e,function(e){if(void 0!==e)return t(e),e;n(Error("Couldn't retrieve key"))})})},createTab:function(e){if(void 0!==chrome.tabs.create)return void chrome.tabs.create(e)},extensionGetURL:function(e){return void 0!==chrome.extension.getURL&&chrome.extension.getURL(e)}};pullTabs.Browser.ENV,pullTabs.Browser.ENV,pullTabs.Browser.init(pullTabs);var pullTabs=pullTabs||{};pullTabs.Pocket=pullTabs.Pocket||{pocketKey:{access_token:"access_token",user_name:"user_name"},init:function(){if(void 0!==localStorage[this.pocketKey.user_name]&&"user_name"!==localStorage[this.pocketKey.user_name])return void this.isAuthorized();this.isNotAuthorized()},checkLocalLoginStatus:function(){if(void 0!==localStorage[this.pocketKey.user_name]&&"user_name"!==localStorage[this.pocketKey.user_name])return void this.isAuthorized();this.isNotAuthorized()},isAuthorized:function(){var e=document.getElementById("pocket-status");null!==e&&(e.href="#pocket-logout",e.textContent="You are signed in as "+decodeURIComponent(localStorage[this.pocketKey.user_name])+" Click to log out.")},isNotAuthorized:function(){var e=document.getElementById("pocket-status");e.href="#pocket-login",e.textContent="You are not authorized, please sign in."},logOut:function(){localStorage[this.pocketKey.user_name]="user_name",localStorage[this.pocketKey.access_token]="access_token",chrome.storage.local.set({access_token:"access_token",user_name:"user_name"},function(e){}),this.isNotAuthorized()},checkLink:function(e){var t=e.target.href.indexOf("#")+1;if("pocket-logout"===e.target.href.substring(t))return void pullTabs.Pocket.logOut();pullTabs.Pocket.initLogin()},initLogin:function(){var e={};e.url="https://getpocket.com/v3/oauth/request",e.key=pullTabs.Config.credentials.consumer_key,pullTabs.Pocket.getRequestToken(e)},saveTabToPocket:function(e){var t=e.url,a={url:t,consumer_key:pullTabs.Config.credentials.consumer_key,access_token:localStorage[this.pocketKey.access_token]};try{var n=new XMLHttpRequest;n.overrideMimeType("application/json"),n.open("POST","https://getpocket.com/v3/add",!1),n.setRequestHeader("Content-Type","application/json; charset=UTF-8"),n.setRequestHeader("X-Accept","application/json");var s,o=document.createElement("a"),l=document.createElement("span");o.title=e.title,o.href=e.url,o.innerHTML=e.title,n.onreadystatechange=function(){if(4===n.readyState&&200!==n.status)return void 0!==e.labelTabId&&e.labelTabId,s=document.createTextNode("Failed saving to Pocket "),l.appendChild(s),l.appendChild(o),pullTabs.App.updateStatusMessage(l,"dependent","danger"),!1;if(4===n.readyState&&200===n.status){void 0!==e.labelTabId&&e.labelTabId,s=document.createTextNode("Saved this tab to pocket: "),l.appendChild(s),l.appendChild(o),pullTabs.App.updateStatusMessage(l,"medium","success");return!0}},n.onerror=function(t){pullTabs.Form.setLabelStatus(e,"failed")},n.send(JSON.stringify(a))}catch(t){return pullTabs.Form.setLabelStatus(e,"failed"),!1}},saveTabsToPocket:function(e){var t,a=e.length;for(t=0;t<a;t++)this.saveTabToPocket(e[t])},getRequestToken:function(e){var t=chrome.extension.getURL("pocket.html"),a=new FormData;a.append("consumer_key",e.key),a.append("redirect_uri",encodeURIComponent(t));var n=new XMLHttpRequest;n.open("POST",e.url,!0),n.onload=function(t){4===n.readyState&&200===n.status&&(e.token=n.response.substring(5),localStorage[pullTabs.Pocket.pocketKey.request_token]=e.token,e.auth="https://getpocket.com/auth/authorize?request_token="+e.token+"&redirect_uri=",pullTabs.Browser.login(e))},n.onerror=function(e){},n.send(a)},getStoredCredentials:function(e){chrome.storage.local&&chrome.storage.local.get({access_token:"access_token",user_name:"user_name"},function(e){"user_name"!==e.user_name?pullTabs.Pocket.isAuthorized(e):pullTabs.Pocket.isNotAuthorized()})},setStoredCredentials:function(e){var t=e.search("=")+1,a=e.search("&"),n=a+10,s=e.substring(t,a),o=e.substring(n);localStorage[this.pocketKey.access_token]=s,localStorage[this.pocketKey.user_name]=o,this.isAuthorized()},getAccessToken:function(e){var e={};e.url="https://getpocket.com/v3/oauth/authorize",e.key=pullTabs.Config.credentials.consumer_key,e.token=localStorage[this.pocketKey.request_token];var t=new FormData;t.append("consumer_key",e.key),t.append("code",e.token);var a=new XMLHttpRequest;a.open("POST",e.url,!0),a.onload=function(e){4===a.readyState&&200===a.status&&pullTabs.Pocket.setStoredCredentials(a.response)},a.onerror=function(e){},a.send(t)}};