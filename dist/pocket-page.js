var pullTabs=pullTabs||{},pullTabs=pullTabs||{};pullTabs.Config=pullTabs.Config||function(){return{credentials:{consumer_key:"***REMOVED***"},configuration:{mode:"PRODUCTION"},app:{name:"Pull Tabs"}}}();var pullTabs=pullTabs||{};pullTabs.Pocket=pullTabs.Pocket||{pocketKey:{access_token:"access_token",user_name:"user_name"},init:function(){if(void 0!==localStorage[this.pocketKey.user_name]&&"user_name"!==localStorage[this.pocketKey.user_name])return void this.isAuthorized();this.isNotAuthorized()},checkLocalLoginStatus:function(){if(void 0!==localStorage[this.pocketKey.user_name]&&"user_name"!==localStorage[this.pocketKey.user_name])return void this.isAuthorized();this.isNotAuthorized()},isAuthorized:function(){var e=document.getElementById("pocket-status");null!==e&&(e.href="#pocket-logout",e.textContent="You are signed in as "+decodeURIComponent(localStorage[this.pocketKey.user_name])+" Click to log out.")},isNotAuthorized:function(){var e=document.getElementById("pocket-status");e.href="#pocket-login",e.textContent="You are not authorized, please sign in."},logOut:function(){localStorage[this.pocketKey.user_name]="user_name",localStorage[this.pocketKey.access_token]="access_token",chrome.storage.local.set({access_token:"access_token",user_name:"user_name"},function(e){}),this.isNotAuthorized()},checkLink:function(e){var t=e.target.href.indexOf("#")+1;if("pocket-logout"===e.target.href.substring(t))return void pullTabs.Pocket.logOut();pullTabs.Pocket.initLogin()},initLogin:function(){var e={};e.url="https://getpocket.com/v3/oauth/request",e.key=pullTabs.Config.credentials.consumer_key,pullTabs.Pocket.getRequestToken(e)},saveTabToPocket:function(e){var t=e.url,o={url:t,consumer_key:pullTabs.Config.credentials.consumer_key,access_token:localStorage[this.pocketKey.access_token]};try{var a=new XMLHttpRequest;a.overrideMimeType("application/json"),a.open("POST","https://getpocket.com/v3/add",!1),a.setRequestHeader("Content-Type","application/json; charset=UTF-8"),a.setRequestHeader("X-Accept","application/json");var n,s=document.createElement("a"),r=document.createElement("span");s.title=e.title.toString(),s.href=e.url,s.textContent=e.title.toString(),a.onreadystatechange=function(){if(4===a.readyState&&200!==a.status)return void 0!==e.labelTabId&&e.labelTabId,n=document.createTextNode("Failed saving to Pocket "),r.appendChild(n),r.appendChild(s),pullTabs.App.updateStatusMessage(r,"dependent","danger"),!1;if(4===a.readyState&&200===a.status){void 0!==e.labelTabId&&e.labelTabId,n=document.createTextNode("Saved this tab to pocket: "),r.appendChild(n),r.appendChild(s),pullTabs.App.updateStatusMessage(r,"medium","success");return!0}},a.onerror=function(t){pullTabs.Form.setLabelStatus(e,"failed")},a.send(JSON.stringify(o))}catch(t){return pullTabs.Form.setLabelStatus(e,"failed"),!1}},saveTabsToPocket:function(e){var t,o=e.length;for(t=0;t<o;t++)this.saveTabToPocket(e[t])},getRequestToken:function(e){var t=chrome.extension.getURL("pocket.html"),o=new FormData;o.append("consumer_key",e.key),o.append("redirect_uri",encodeURIComponent(t));var a=new XMLHttpRequest;a.open("POST",e.url,!0),a.onload=function(t){4===a.readyState&&200===a.status&&(e.token=a.response.substring(5),localStorage[pullTabs.Pocket.pocketKey.request_token]=e.token,e.auth="https://getpocket.com/auth/authorize?request_token="+e.token+"&redirect_uri=",pullTabs.Browser.login(e))},a.onerror=function(e){},a.send(o)},getStoredCredentials:function(e){chrome.storage.local&&chrome.storage.local.get({access_token:"access_token",user_name:"user_name"},function(e){"user_name"!==e.user_name?pullTabs.Pocket.isAuthorized(e):pullTabs.Pocket.isNotAuthorized()})},setStoredCredentials:function(e){var t=e.search("=")+1,o=e.search("&"),a=o+10,n=e.substring(t,o),s=e.substring(a);localStorage[this.pocketKey.access_token]=n,localStorage[this.pocketKey.user_name]=s,this.isAuthorized()},getAccessToken:function(e){var e={};e.url="https://getpocket.com/v3/oauth/authorize",e.key=pullTabs.Config.credentials.consumer_key,e.token=localStorage[this.pocketKey.request_token];var t=new FormData;t.append("consumer_key",e.key),t.append("code",e.token);var o=new XMLHttpRequest;o.open("POST",e.url,!0),o.onload=function(e){4===o.readyState&&200===o.status&&pullTabs.Pocket.setStoredCredentials(o.response)},o.onerror=function(e){},o.send(t)}};var pullTabs=pullTabs||{};pullTabs.Pocket.getAccessToken();